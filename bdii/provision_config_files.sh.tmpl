#!/bin/env bash

# provision_config_files.sh
# Reproduces part of: https://github.com/EGI-Federation/bdii/blob/main/etc/systemd/bdii-slapd-start

# Provisions files for configuring the openldap server

# Create Database directory
# was SLAPD_DB_DIR=${SLAPD_DB_DIR:-$BDII_VAR_DIR/db} where SLAPD_DB_DIR is /var/lib/bdii
# We should mount this into tmpfs, but who knows if that's possible

mkdir -vp {{ env "NOMAD_ALLOC_DIR" }}/{{ env "SLAPD_DB_DIR" }}/stats
mkdir -vp {{ env "NOMAD_ALLOC_DIR" }}/{{ env "SLAPD_DB_DIR" }}/glue
mkdir -vp {{ env "NOMAD_ALLOC_DIR" }}/{{ env "SLAPD_DB_DIR" }}/grid
mkdir -vp {{ env "NOMAD_ALLOC_DIR" }}/{{ env "BDII_VAR_DIR" }}/archive
